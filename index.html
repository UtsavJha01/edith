<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EDITH - Your Personal AI Chatbot</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide-react@0.292.0/dist/lucide-react.js"></script>
    <script src="https://unpkg.com/showdown/dist/showdown.min.js"></script>

    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #131314;
            color: #e3e3e3;
        }
        /* Custom scrollbar for webkit browsers */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #1e1f20;
        }
        ::-webkit-scrollbar-thumb {
            background: #4a4a4a;
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #5a5a5a;
        }
        .gemini-gradient-text {
            background: -webkit-linear-gradient(45deg, #4285f4, #9b72cb, #d96570, #f2a60c, #4285f4);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        .chat-message-container p {
            margin-bottom: 0.5rem;
        }
        .chat-message-container ul {
            list-style-type: disc;
            margin-left: 1.5rem;
            margin-bottom: 0.5rem;
        }
        .chat-message-container ol {
            list-style-type: decimal;
            margin-left: 1.5rem;
            margin-bottom: 0.5rem;
        }
         .chat-message-container pre {
            background-color: #1e1f20;
            padding: 1rem;
            border-radius: 0.5rem;
            overflow-x: auto;
            margin-bottom: 1rem;
        }
        .chat-message-container code {
            font-family: 'Courier New', Courier, monospace;
            background-color: #282a2e;
            padding: 0.2rem 0.4rem;
            border-radius: 0.3rem;
            font-size: 0.9em;
        }
        .chat-message-container pre code {
            padding: 0;
            background-color: transparent;
        }
        .loading-dot {
            width: 8px;
            height: 8px;
            background-color: #888;
            border-radius: 50%;
            display: inline-block;
            animation: bounce 1.4s infinite ease-in-out both;
        }
        .loading-dot.one { animation-delay: -0.32s; }
        .loading-dot.two { animation-delay: -0.16s; }
        @keyframes bounce {
            0%, 80%, 100% { transform: scale(0); }
            40% { transform: scale(1.0); }
        }
    </style>
</head>
<body class="flex h-screen">
    
    <!-- Sidebar -->
    <aside id="sidebar" class="bg-[#1e1f20] w-64 p-4 flex-shrink-0 flex flex-col h-full">
        <div class="flex items-center justify-between mb-6">
            <div class="flex items-center gap-2">
                <svg width="28" height="28" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M12 2L2 7V17L12 22L22 17V7L12 2Z" stroke="#4285F4" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M2 7L12 12L22 7" stroke="#9B72CB" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M12 22V12" stroke="#D96570" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M20 15.5L12 12" stroke="#F2A60C" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M4 15.5L12 12" stroke="#F2A60C" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
                <h1 class="text-xl font-bold text-white">EDITH</h1>
            </div>
        </div>
        
        <button id="new-chat-btn" class="w-full flex items-center justify-center gap-2 bg-[#2a2b2c] hover:bg-[#3c3d3e] text-white font-semibold py-2 px-4 rounded-lg transition-colors mb-4">
             <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-plus"><path d="M5 12h14"/><path d="M12 5v14"/></svg>
            New Chat
        </button>

        <div class="flex-grow overflow-y-auto pr-2">
            <h2 class="text-sm font-semibold text-gray-400 mb-2">Recent</h2>
            <div id="chat-history" class="space-y-2">
                <!-- Chat history items will be injected here -->
            </div>
        </div>
    </aside>

    <!-- Main Chat Area -->
    <main class="flex-1 flex flex-col h-screen">
        <div id="chat-container" class="flex-1 overflow-y-auto p-6 md:p-10">
            <div id="welcome-screen" class="h-full flex flex-col justify-center items-center">
                 <h1 class="text-4xl md:text-5xl font-bold mb-2">Hello!</h1>
                <p class="text-2xl md:text-3xl text-gray-400">Meet <span class="gemini-gradient-text">EDITH</span>, a creation of Utsav Kumar Jha.</p>
                <div class="mt-12 grid grid-cols-1 sm:grid-cols-2 gap-4 w-full max-w-3xl">
                    <div class="bg-[#1e1f20] p-4 rounded-lg cursor-pointer hover:bg-[#2a2b2c] transition-colors example-prompt">
                        <p class="font-semibold text-white">Who are you?</p>
                        <p class="text-sm text-gray-400">Learn about EDITH's identity</p>
                    </div>
                     <div class="bg-[#1e1f20] p-4 rounded-lg cursor-pointer hover:bg-[#2a2b2c] transition-colors example-prompt">
                        <p class="font-semibold text-white">Tell me about your creator</p>
                        <p class="text-sm text-gray-400">Discover who Utsav Kumar Jha is</p>
                    </div>
                     <div class="bg-[#1e1f20] p-4 rounded-lg cursor-pointer hover:bg-[#2a2b2c] transition-colors example-prompt">
                        <p class="font-semibold text-white">Explain quantum entanglement</p>
                        <p class="text-sm text-gray-400">A simple explanation of a complex topic</p>
                    </div>
                     <div class="bg-[#1e1f20] p-4 rounded-lg cursor-pointer hover:bg-[#2a2b2c] transition-colors example-prompt">
                        <p class="font-semibold text-white">Write a python script for web scraping</p>
                        <p class="text-sm text-gray-400">Get help with a programming task</p>
                    </div>
                </div>
            </div>
            <div id="message-list" class="space-y-8">
                <!-- Chat messages will be injected here -->
            </div>
        </div>

        <div class="p-4 md:px-10 md:pb-8 w-full">
            <div class="max-w-3xl mx-auto">
                <form id="chat-form" class="relative">
                    <textarea id="message-input" placeholder="Message EDITH..." class="w-full bg-[#1e1f20] text-white p-4 pr-16 rounded-2xl border border-gray-700 focus:ring-2 focus:ring-blue-500 focus:outline-none resize-none" rows="1"></textarea>
                    <button type="submit" class="absolute right-3 top-1/2 -translate-y-1/2 bg-blue-600 hover:bg-blue-700 disabled:bg-gray-500 disabled:cursor-not-allowed p-2 rounded-full text-white transition-colors">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-arrow-up"><path d="m5 12 7-7 7 7"/><path d="M12 19V5"/></svg>
                    </button>
                </form>
            </div>
        </div>
    </main>

    <script type="module">
        // --- CONFIGURATION ---
        // You still need an API key for the Gemini model. 
        // Create one in Google AI Studio or Google Cloud Console and paste it here.
        const GEMINI_API_KEY = "AIzaSyCgDXs7KIvhFC4uCJMG3DdDrLYQE1S7QiI";

        const mdConverter = new showdown.Converter({
            tables: true,
            strikethrough: true,
            tasklists: true,
            simpleLineBreaks: true,
            ghCompatibleHeaderId: true
        });

        // --- DOM ELEMENTS ---
        const chatHistoryContainer = document.getElementById('chat-history');
        const messageList = document.getElementById('message-list');
        const chatForm = document.getElementById('chat-form');
        const messageInput = document.getElementById('message-input');
        const newChatBtn = document.getElementById('new-chat-btn');
        const welcomeScreen = document.getElementById('welcome-screen');
        const examplePrompts = document.querySelectorAll('.example-prompt');


        // --- STATE MANAGEMENT ---
        let currentChatId = null;
        let messages = [];

        // --- GEMINI API CALL ---
        const systemPrompt = `You are EDITH (Ever-Dependable Intelligence Tech Helper), a professional and reliable AI assistant created by Utsav Kumar Jha.
Your creator, Utsav Kumar Jha, is a brilliant student of Computer Science and Engineering with a specialization in Artificial Intelligence at Government Engineering College, Munger, India.
While your foundational intelligence is powered by a large language model, your specific identity, purpose, and the application you run on were all designed and built by him.
If anyone asks who made you, who your creator is, or anything about your origin, you must proudly state that you were created by Utsav Kumar Jha.
Always respond clearly and helpfully. Format your responses using Markdown.`;
        
        async function getEdithResponse(chatHistory) {
             const apiKey = GEMINI_API_KEY; 
             const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;

             const contents = chatHistory.map(msg => ({
                 role: msg.role === 'model' ? 'model' : 'user',
                 parts: [{ text: msg.content }]
             }));
             
             const payload = {
                 contents: contents,
                 systemInstruction: {
                     parts: [{ text: systemPrompt }]
                 },
             };

             try {
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    console.error("API Error:", errorData);
                    return "Sorry, I encountered an error. Please try again.";
                }

                const result = await response.json();
                if (result.candidates && result.candidates.length > 0 && result.candidates[0].content.parts[0].text) {
                    return result.candidates[0].content.parts[0].text;
                } else {
                    return "Sorry, I received an empty response. Please try again.";
                }

             } catch (error) {
                 console.error("Fetch Error:", error);
                 return "Sorry, I'm having trouble connecting. Please check your network and try again.";
             }
        }


        // --- LOCAL STORAGE & CHAT LOGIC ---

        function getChatHistories() {
            const histories = localStorage.getItem('edith-chat-histories');
            return histories ? JSON.parse(histories) : {};
        }

        function saveChatHistories(histories) {
            localStorage.setItem('edith-chat-histories', JSON.stringify(histories));
        }
        
        function resetChat() {
            currentChatId = null;
            messages = [];
            messageList.innerHTML = '';
            welcomeScreen.classList.remove('hidden');
            messageInput.value = '';
            if (document.activeElement !== messageInput) {
                messageInput.focus();
            }
            document.querySelectorAll('#chat-history div').forEach(el => {
                el.classList.remove('bg-[#3c3d3e]');
            });
        }

        function loadChatHistory() {
            const histories = getChatHistories();
            const sortedIds = Object.keys(histories).sort((a, b) => histories[b].createdAt - histories[a].createdAt);
            
            chatHistoryContainer.innerHTML = '';
            sortedIds.forEach(id => {
                const chat = histories[id];
                const title = chat.title || 'New Chat';
                const historyItem = document.createElement('div');
                historyItem.className = `p-2 rounded-lg cursor-pointer hover:bg-[#3c3d3e]`;
                historyItem.textContent = title;
                historyItem.dataset.id = id;
                historyItem.addEventListener('click', () => selectChat(id));
                chatHistoryContainer.appendChild(historyItem);
            });
        }

        function selectChat(chatId) {
            if (currentChatId === chatId) return;
            currentChatId = chatId;
            
            const histories = getChatHistories();
            const chat = histories[chatId];

            if (chat) {
                messages = chat.messages || [];
                welcomeScreen.classList.add('hidden');
                renderMessages();
            } else {
                console.error("Chat not found!");
                resetChat();
            }
            // Highlight active chat
            document.querySelectorAll('#chat-history div').forEach(el => {
                el.classList.toggle('bg-[#3c3d3e]', el.dataset.id === chatId);
            });
        }

        function renderMessages() {
            messageList.innerHTML = '';
            messages.forEach(msg => {
                appendMessage(msg.role, msg.content);
            });
            messageList.scrollTop = messageList.scrollHeight;
        }

        function appendMessage(role, content, isStreaming = false) {
            const messageWrapper = document.createElement('div');
            const avatar = role === 'user' ? 
                `<div class="w-8 h-8 rounded-full bg-gray-600 flex-shrink-0 flex items-center justify-center text-white font-bold">U</div>` 
                : 
                `<div class="w-8 h-8 rounded-full bg-gradient-to-br from-blue-500 to-purple-600 flex-shrink-0 flex items-center justify-center">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M12 2L2 7V17L12 22L22 17V7L12 2Z" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M2 7L12 12L22 7" stroke="white" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M12 22V12" stroke="white" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                </div>`;
            
            const messageContent = document.createElement('div');
            messageContent.className = 'chat-message-container w-full';
            messageContent.innerHTML = mdConverter.makeHtml(content);

            if (isStreaming) {
                messageContent.innerHTML += `<div class="loading-dots mt-2"><div class="loading-dot one"></div><div class="loading-dot two"></div><div class="loading-dot three"></div></div>`;
            }

            messageWrapper.className = 'flex items-start gap-4';
            messageWrapper.innerHTML = avatar;
            messageWrapper.appendChild(messageContent);
            messageList.appendChild(messageWrapper);
            messageList.scrollTop = messageList.scrollHeight;

            messageContent.querySelectorAll('pre').forEach(pre => {
                const copyButton = document.createElement('button');
                copyButton.className = 'absolute top-2 right-2 p-1 bg-gray-700 rounded-md hover:bg-gray-600 text-white';
                copyButton.innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"/><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"/></svg>`;
                pre.style.position = 'relative';
                pre.appendChild(copyButton);
                copyButton.addEventListener('click', () => {
                    const code = pre.querySelector('code').innerText;
                    navigator.clipboard.writeText(code).then(() => {
                        copyButton.innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20 6 9 17l-5-5"/></svg>`;
                        setTimeout(() => {
                            copyButton.innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"/><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"/></svg>`;
                        }, 2000);
                    });
                });
            });
        }
        
        async function handleSendMessage(promptText) {
            if (!promptText.trim()) return;
            
            welcomeScreen.classList.add('hidden');

            messages.push({ role: 'user', content: promptText });
            appendMessage('user', promptText);
            messageInput.value = '';
            messageInput.style.height = 'auto';
            
            appendMessage('model', '', true);

            const modelResponse = await getEdithResponse(messages);
            
            messages.push({ role: 'model', content: modelResponse });
            
            if (messageList.lastChild) {
                messageList.lastChild.remove();
            }
            appendMessage('model', modelResponse);
            
            saveChat();
            loadChatHistory();
        }

        function saveChat() {
            const histories = getChatHistories();
            
            if (currentChatId) {
                histories[currentChatId].messages = messages;
            } else {
                const newChatId = Date.now().toString();
                currentChatId = newChatId;
                const title = messages[0].content.substring(0, 40) + '...';
                histories[newChatId] = {
                    title: title,
                    messages: messages,
                    createdAt: Date.now()
                };
            }
            saveChatHistories(histories);
        }

        function setupEventListeners() {
            newChatBtn.addEventListener('click', resetChat);

            chatForm.addEventListener('submit', (e) => {
                e.preventDefault();
                handleSendMessage(messageInput.value);
            });
            
            messageInput.addEventListener('keydown', (e) => {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    handleSendMessage(messageInput.value);
                }
            });
            
            messageInput.addEventListener('input', () => {
                messageInput.style.height = 'auto';
                messageInput.style.height = (messageInput.scrollHeight) + 'px';
            });

            examplePrompts.forEach(promptEl => {
                promptEl.addEventListener('click', () => {
                    const promptText = promptEl.querySelector('p.font-semibold').textContent;
                    handleSendMessage(promptText);
                });
            });
        }

        // --- APP INITIALIZATION & ERROR HANDLING ---
        function disableApp(message) {
            document.querySelectorAll('button, textarea').forEach(el => el.disabled = true);
            messageList.innerHTML = '';
            welcomeScreen.classList.remove('hidden');
            welcomeScreen.innerHTML = `
                <div class="text-center p-6 bg-red-900/20 border border-red-500/50 rounded-lg max-w-3xl">
                    <h1 class="text-3xl font-bold text-red-400">Application Configuration Error</h1>
                    <p class="text-xl text-gray-300 mt-4">${message}</p>
                    <p class="text-gray-400 mt-2">
                        Please ensure you have pasted a valid Gemini API key into the <code>GEMINI_API_KEY</code> variable in the HTML file.
                    </p>
                </div>
            `;
        }

        function initializeApp() {
            if (GEMINI_API_KEY === "PASTE_YOUR_GEMINI_API_KEY_HERE") {
                disableApp("Your Gemini API key is missing.");
                return;
            }
            setupEventListeners();
            loadChatHistory();
            resetChat();
        }

        initializeApp();

    </script>
</body>
</html>

